# Criterium 5.2: Verbeter voorstellen op basis van oplevering

## Verbeter voorstel: Implementeren van email verificatie bij registratie

**Aanleiding:**
Bij de oplevering van het product is gebleken dat bij de registratie functionaliteit (US-1) alleen basis email format validatie wordt uitgevoerd. Er wordt niet geverifieerd of het ingevoerde emailadres daadwerkelijk bestaat en bereikbaar is. Dit kan leiden tot problemen zoals spam accounts, ongeldige accounts en problemen bij account recovery.

**Probleem:**
- Gebruikers kunnen zich registreren met ongeldige of niet-bestaande emailadressen
- Alleen format validatie wordt uitgevoerd (bijvoorbeeld: `test@example.com` wordt geaccepteerd zonder te controleren of dit emailadres echt bestaat)
- Geen verificatie dat de gebruiker daadwerkelijk toegang heeft tot het opgegeven emailadres
- Dit kan leiden tot:
  - Spam accounts met valse emailadressen
  - Problemen bij wachtwoord reset functionaliteit (emails kunnen niet worden verzonden)
  - Moeilijkheden bij account recovery
  - Lagere data kwaliteit in de database

**Oplossing:**
Implementeer email verificatie systeem met de volgende componenten:

1. **Email verificatie flow:**
   - Na registratie wordt een verificatie email verzonden naar het opgegeven adres
   - Gebruiker moet op een link in de email klikken om account te activeren
   - Account blijft inactief tot verificatie is voltooid
   - Verificatie token wordt opgeslagen in database met expiration tijd (bijvoorbeeld 24 uur)

2. **Backend implementatie:**
   - Maak email service voor het verzenden van verificatie emails (bijvoorbeeld met Nodemailer of SendGrid)
   - Genereer unieke verificatie token voor elke registratie
   - Maak API endpoint `/api/auth/verify-email` voor verificatie link
   - Update User model met `emailVerified` boolean en `verificationToken` veld
   - Implementeer token expiration en cleanup van oude tokens

3. **Frontend implementatie:**
   - Toon duidelijke melding na registratie: "Controleer je email voor verificatie"
   - Maak verificatie pagina die token verwerkt
   - Voeg optie toe om verificatie email opnieuw te verzenden
   - Toon status van email verificatie op profiel/settings pagina
   - Optioneel: beperk functionaliteit voor niet-geverifieerde accounts

4. **Email validatie verbeteringen:**
   - Naast format validatie, voeg DNS lookup toe om te controleren of email domain bestaat
   - Optioneel: gebruik email verification service (zoals EmailListVerify of ZeroBounce) voor real-time validatie
   - Valideer MX records van email domain

**Relatie met oplevering en user stories:**
Dit voorstel verbetert de functionaliteit en het gebruik van de ontwikkelde software zoals beschreven in de user stories:
- **US-1 (Registratie/Login)**: Verbeterde account security en data kwaliteit door email verificatie
- **US-16 (Settings)**: Email verificatie status kan worden getoond in settings
- **Toekomstige features**: Wachtwoord reset functionaliteit (voorstel 1) vereist geldige emailadressen om te werken

**Impact:**
- Verbeterde beveiliging: voorkomt spam accounts en valse registraties
- Betere data kwaliteit: alleen gebruikers met geldige emailadressen kunnen accounts aanmaken
- Professionele uitstraling: email verificatie is standaard in moderne applicaties
- Basis voor account recovery: geldige emails zijn essentieel voor wachtwoord reset functionaliteit
- Betere gebruikerservaring: gebruikers weten zeker dat hun account veilig is en kunnen emails ontvangen

---

## Planning voor uitvoering

### Sprint 2: Email verificatie bij registratie (Week 2)

**Prioriteit:** Hoog  
**Geschatte tijd:** 10-14 uur  
**Complexiteit:** Medium-Hoog  
**Afhankelijkheden:** Email service configuratie

**Dag 1: Email service setup en backend basis (3-4 uur)**
- [ ] Configureer email service (Nodemailer of SendGrid)
- [ ] Stel environment variables in voor email credentials
- [ ] Update User model met `emailVerified` en `verificationToken` velden
- [ ] Maak functie voor het genereren van verificatie tokens
- [ ] Test email service configuratie

**Dag 2-3: Backend API implementatie (4-6 uur)**
- [ ] Update registratie endpoint om verificatie email te verzenden
- [ ] Maak `/api/auth/verify-email` endpoint voor verificatie
- [ ] Implementeer token expiration en validatie
- [ ] Maak endpoint voor opnieuw verzenden van verificatie email
- [ ] Implementeer cleanup van verlopen tokens
- [ ] Test alle backend endpoints

**Dag 4-5: Frontend implementatie (3-4 uur)**
- [ ] Update registratie formulier met verificatie flow
- [ ] Maak email verificatie pagina component
- [ ] Implementeer "Verificatie email opnieuw verzenden" functionaliteit
- [ ] Toon verificatie status op profiel/settings pagina
- [ ] Voeg gebruiksvriendelijke feedback toe (success/error messages)
- [ ] Test volledige flow van registratie tot verificatie

**Acceptatiecriteria:**
- Gebruikers ontvangen verificatie email na registratie
- Verificatie link werkt en activeert account correct
- Token expiration wordt correct afgehandeld
- Gebruikers kunnen verificatie email opnieuw aanvragen
- Niet-geverifieerde accounts kunnen worden geïdentificeerd
- Email format en DNS validatie werken correct

---

## Risico's en mitigatie

**Risico 1: Email service configuratie**
- *Mitigatie*: Gebruik betrouwbare email services zoals SendGrid of Nodemailer. Test grondig in development omgeving voordat productie deployment.

**Risico 2: Email deliverability**
- *Mitigatie*: Configureer SPF, DKIM en DMARC records correct. Gebruik email service met goede deliverability rates.

**Risico 3: Technische complexiteit**
- *Mitigatie*: Begin met basis verificatie flow en voeg geavanceerde features (DNS lookup) later toe indien nodig.

---

## Succescriteria

Dit verbetervoorstel is succesvol wanneer:
- ✅ Email verificatie werkt correct en gebruikers kunnen alleen registreren met geldige emails
- ✅ Verificatie emails worden betrouwbaar verzonden en ontvangen
- ✅ Gebruikers kunnen hun email verifiëren via de verificatie link
- ✅ Token expiration en security worden correct afgehandeld
